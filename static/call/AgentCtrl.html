<HTML>
	<HEAD>
		<LINK href="inc/FRM1.css" type="text/css" rel="stylesheet">
			<SCRIPT  type="text/javascript">
			
			//从服务器获取到CTI服务器的地址、该登陆工号对应的分机号与密码：
			var CtiSvr="192.168.0.33";
			var ExtNum="8600";
			var AgtPwd="123654";
			//从服务器获取到该登陆工号所分配的技能组的工作组号码，如果为管理员还获取了相应组的管理员密码：
			var WGs="2000,1000";
			var MonPwds="123654,123654";
			//var MonPwds=",";
			var action;
			//由于控件可能还没有来得及完成初始化，可能需要再次登陆
			var RetryTimes=0;//登陆次数
			var isLogoned=false;//是否已经登陆

		function initTelCtrl()
		{
	    if(AgentCtrl.Alert2Event!=undefined )
			{
				window.clearTimeout(action);
				AgentCtrl.Alert2Event=true;
				if(AgentCtrl.LogonExt(CtiSvr,ExtNum,AgtPwd))
				   AgentCtrl.LogonWgps(WGs,MonPwds);
			}
			else{
				if(RetryTimes++>=0){
						if(AgentCtrl.Alert2Event==undefined )
							alert("电话控件没有加载，请检查您的权限或网络。");
						else
							alert("登陆失败，请您稍后自行登陆！");
						window.clearTimeout(action);
				}
				else
					action=window.setTimeout('initTelCtrl()',1000);
			}
			
		}
		function unInitTelCtrl()
		{
			AgentCtrl.Logoff();
		}

			// Harvey
			function RefreshTime()
			{
				var curTime = new Date();
				var strNow = curTime.getFullYear() + "年" + (curTime.getMonth() + 1) + "月" + curTime.getDate() + "日";
							 
				switch (curTime.getDay())
				{
				case 0:
					strNow += " 星期日";		break;

				case 1:
					strNow += " 星期一";		break;

				case 2:
					strNow += " 星期二";		break;

				case 3:
					strNow += " 星期三";		break;

				case 4:
					strNow += " 星期四";		break;

				case 5:
					strNow += " 星期五";		break;

				case 6:
					strNow += " 星期六";		break;
				}
				
				if (curTime.getHours() < 12)
					strNow += " 上午" + curTime.getHours() + "点";
				else
				{
					if (curTime.getHours() == 12)
						strNow += " 下午" + curTime.getHours() + "点";
					else
						strNow += " 下午" + (curTime.getHours() - 12) + "点";
				}
				strNow += curTime.getMinutes() + "分" + curTime.getSeconds() + "秒";
				
				Label1.innerHTML = strNow;
				window.setTimeout(RefreshTime, 1000);
			}
			
function FP_swapImg() {//v1.0
 var doc=document,args=arguments,elm,n; doc.$imgSwaps=new Array(); for(n=2; n<args.length;
 n+=2) { elm=FP_getObjectByID(args[n]); if(elm) { doc.$imgSwaps[doc.$imgSwaps.length]=elm;
 elm.$src=elm.src; elm.src=args[n+1]; } }
}

function FP_preloadImgs() {//v1.0
 var d=document,a=arguments; if(!d.FP_imgs) d.FP_imgs=new Array();
 for(var i=0; i<a.length; i++) { d.FP_imgs[i]=new Image; d.FP_imgs[i].src=a[i]; }
}

function FP_getObjectByID(id,o) {//v1.0
 var c,el,els,f,m,n; if(!o)o=document; if(o.getElementById) el=o.getElementById(id);
 else if(o.layers) c=o.layers; else if(o.all) el=o.all[id]; if(el) return el;
 if(o.id==id || o.name==id) return o; if(o.childNodes) c=o.childNodes; if(c)
 for(n=0; n<c.length; n++) { el=FP_getObjectByID(id,c[n]); if(el) return el; }
 f=o.forms; if(f) for(n=0; n<f.length; n++) { els=f[n].elements;
 for(m=0; m<els.length; m++){ el=FP_getObjectByID(id,els[n]); if(el) return el; } }
 return null;
}
</SCRIPT>
	</HEAD>
	<body class="TB" bgcolor="#ffffff" text="#000000" leftmargin="0" topmargin="0" marginwidth="0"
		marginheight="0" onload="FP_preloadImgs(/*url*/'images/button4.jpg', /*url*/'images/button5.jpg'); action=window.setTimeout('initTelCtrl()',1000)" onunload="unInitTelCtrl();">
		　<table width="100%" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td height="58" background="images/top_bg.gif" align="left" width="33%">
				<img src="images/HomeLogo.jpg" height="58" width="167">
				</td>
				<td height="58" background="images/top_bg.gif" align="center" width="34%">
				<img src="images/JLQX_Info.gif" height="58">
				</td>
				<td height="58" background="images/top_bg.gif" width="33%" align="right" valign="bottom">
					<Label id="Label1" Width="100%"  CssClass="TIME_STRING" Height="23px"></Label>
				</td>
			</tr>
			<tr>
				<td bgcolor="#2a79ba" colspan="3" align="center" height="30"><FONT face="宋体">
						<OBJECT codeBase="AltiAgentCtrl.cab#version=2,0,14,1" align="middle" classid="clsid:E60A02EA-8BB4-4239-834B-785575B6EBCB"
							name="AgentCtrl" id="AgentCtrl" width="1150" height="19">
							<PARAM NAME="_Version" VALUE="65536">
							<PARAM NAME="_ExtentX" VALUE="30427">
							<PARAM NAME="_ExtentY" VALUE="503">
							<PARAM NAME="_StockProps" VALUE="0">
						</OBJECT>
					<img border="0" id="img1" onclick="AgentCtrl.SetUserData('SC,1');AgentCtrl.TransferCall('5566');" src="images/button3.jpg" height="20" width="100" alt="满意度调查" onmouseover="FP_swapImg(1,0,/*id*/'img1',/*url*/'images/button4.jpg')" onmouseout="FP_swapImg(0,0,/*id*/'img1',/*url*/'images/button3.jpg')" onmousedown="FP_swapImg(1,0,/*id*/'img1',/*url*/'images/button5.jpg')" onmouseup="FP_swapImg(0,0,/*id*/'img1',/*url*/'images/button4.jpg')" fp-style="fp-btn: Braided Row 1; fp-font: SimSun-ExtB" fp-title="满意度调查"></FONT></td>
			</tr>
		</table>
		<table width="910" border="0" cellspacing="0" cellpadding="0" height="16">
			<tr>
				<td height="16"><FONT face="宋体"></FONT>
				</td>
			</tr>
		</table>
		<SCRIPT language="JavaScript" event="OnError(lErrorLevel, strErrorContent)" for="AgentCtrl">
  		alert(strErrorContent);
 		</SCRIPT>

		<SCRIPT language="JavaScript" event="LineEvent(lLineState, lPrevState)" for="AgentCtrl">
  
  <!--
   //frm_SysMod.document.eventform.T1.value = "lLineState=" + lLineState + ", szAgentNum=\"" + szAgentNum + "\""
  -->  
		</SCRIPT>
		<SCRIPT language="JavaScript" event="CallEvent(lCallID,lCallState, lPrevState, strCallNumber, strWgpNumber, bIsCallIn)"
			for="AgentCtrl">   
<!--
   //if(bIsCallIn)
   {
		var dt = new Date();
		var strNow = dt.getFullYear() + "-" + (dt.getMonth() + 1) + "-" + dt.getDate() + " " + 
			dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
		
		switch (lCallState)
		{
			case 6:					//  A_CALL_STATE_RINGBACK
			{
				top.frames("frm_CustInfo").document.all.txtCurrTel.value = strCallNumber;
				top.frames("frm_BasicInfo").initSvcinfo(strCallNumber,top.frames("frm_FunNavigate").document.all.lblSvc.innerText,false);
				top.frames("frm_CustInfo").document.all.btnSrch.click();
				break;
			}
			case 15:				//	A_CALL_STATE_RING
			{
				var b = this.GetIvrData("ivrFunction");
				if (b == "")
					b = strWgpNumber;			
				
				//.net不能传输自定义属性
				//top.frames("frm_CustInfo").document.all.txtCurrTel.isCall = "true";
				top.frames("frm_CustInfo").document.all.txtCurrTel.value = "*" + strCallNumber;			// Harvey: "*" for incoming call
				top.frames("frm_CustInfo").document.all.txtSrchCarNum.value = "";
				
				top.frames("frm_BasicInfo").initSvcinfo(strCallNumber, IvrNavigate[b + ",1"], true);
				top.frames("frm_FunNavigate").document.all.txtFunID.value = IvrNavigate[b + ",0"];
				
				if (top.frames("frm_FunNavigate").document.all.txtFunID.value == "" || 
					top.frames("frm_FunNavigate").document.all.txtFunID.value == "undefined")
				{
					top.frames("frm_FunNavigate").document.all.txtFunID.value = "";
					try
					{
						top.frames("frm_FunNavigate").document.all.lblSvc.outerText = "不明呼叫";
					}
					catch (e)
					{
					}
				}
				else
				{
					top.frames("frm_FunNavigate").Form1.submit();
				}
					
				NavigateSm.ev_CallState.value = lCallState;
				NavigateSm.ev_OtherNum.value = strCallNumber;
				
				if (strCallNumber.length < 3)
				{
					// Harvey [
					//top.frames("frm_CustInfo").document.all.btnAdd.disabled = true;
					//top.frames("frm_CustInfo").document.all.btnUpdate.disabled = true;
					// Harvey ]
				}
				else
				{
					//NavigateSm.submit();
					top.frames("frm_CustInfo").document.all.btnSrch.click();
				}
				break;
			}
			case 2:					//	A_CALL_STATE_CONNECTED
			{	
				top.frames("frm_BasicInfo").document.all.txtStart.value = strNow;
				
				// Harvey [
				//top.frames("frm_BasicInfo").document.all.txtTicks.value =  0;
				top.frames("frm_BasicInfo").document.all.totalSeconds.value = -1;			
				top.frames("frm_BasicInfo").RefreshTime();
				// Harvey ]
				break;
			}
			case 13:				//	A_CALL_STATE_DISCONNECT
			{
				top.frames("frm_BasicInfo").document.all.txtEnd.value = strNow;
				if(top.frames("frm_BasicInfo").document.all.txtStart.value!="")
					top.frames("frm_BasicInfo").AddSvcRec() ;
				break;
			}
		}
	}
-->					
		</SCRIPT>
		<form name="NavigateSm" action="CustomerInfo.aspx" method="post" target="top.frm_CustInfo">
			<input type="hidden" value="0" name="ev_CallState"> <input type="hidden" name="ev_AgentNum">
			<input type="hidden" name="ev_OtherNum">
		</form>
	</body>

</HTML>
